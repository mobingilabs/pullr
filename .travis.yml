sudo: required
env:
- DIRNAME_OLD=. BUILT=.
services:
- docker
script: 
- echo "range ${TRAVIS_COMMIT_RANGE}"
- git diff --name-only $TRAVIS_COMMIT_RANGE | while read line; do
    DIRNAME=`dirname ${line}`;
    if [[ "$DIRNAME" == "$DIRNAME_OLD" ]]; then
      echo "current same as old dir, skip (${DIRNAME} = ${DIRNAME_OLD})";
    else
      echo "built = ${BUILT}";
      if [[ $BUILT == *"${DIRNAME}"* ]]; then
        echo "${DIRNAME} already built, skip";
      else
        MKFILE=`echo "${DIRNAME}/Makefile"`;
        if [ -f $MKFILE ]; then
          echo "build ${MKFILE}";
          BUILT=`echo "${BUILT};${DIRNAME}"`;
        fi;
      fi;
    fi;
    DIRNAME_OLD=$DIRNAME;
  done
